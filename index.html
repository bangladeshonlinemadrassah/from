<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>কমেন্ট ও সাবমিশন সিস্টেম</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tiro+Bangla:wght@400;700&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* আপনার CSS স্টাইল এখানে থাকবে */
    /* পূর্ণ স্টাইল পূর্বের মতোই */
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1 class="bangla-font">কমেন্ট ও সাবমিশন সিস্টেম</h1>
      <p class="description bangla-font">আপনার মতামত, পরামর্শ এবং অভিযোগ আমাদের কাছে গুরুত্বপূর্ণ। নিচের ফর্মটি পূরণ করে আপনার মূল্যবান মতামত জানান।</p>
    </header>

    <div class="tabs">
      <button class="tab-btn bangla-font active" data-tab="form">ফর্ম পূরণ করুন</button>
      <button class="tab-btn bangla-font" data-tab="submissions">সাবমিশন দেখুন</button>
    </div>

    <div class="tab-content active" id="form-tab">
      <div class="card">
        <form id="feedback-form">
          <div class="form-group">
            <label for="name" class="bangla-font">নাম</label>
            <input type="text" id="name" name="name" placeholder="আপনার নাম লিখুন" required class="bangla-font">
          </div>
          
          <div class="form-group">
            <label for="batch" class="bangla-font">ব্যাচ</label>
            <select id="batch" name="batch" required class="bangla-font">
              <option value="" disabled selected class="bangla-font">ব্যাচ নির্বাচন করুন</option>
              <option value="Alim-25" class="bangla-font">আলিম-২৫</option>
              <option value="Dakhil-26" class="bangla-font">দাখিল-২৬</option>
              <option value="Alim-26" class="bangla-font">আলিম-২৬</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="message" class="bangla-font">মতামত/পরামর্শ/অভিযোগ</label>
            <textarea id="message" name="message" placeholder="আপনার মতামত, পরামর্শ, বা অভিযোগ লিখুন" required class="bangla-font"></textarea>
          </div>
          
          <button type="submit" class="btn bangla-font" id="submit-btn">
            <i class="fas fa-paper-plane"></i> জমা দিন
          </button>
        </form>
      </div>
    </div>

    <div class="tab-content" id="submissions-tab">
      <div class="card">
        <h2 class="bangla-font" style="margin-bottom: 20px;">সব সাবমিশন</h2>
        <div id="submissions-list" class="submissions-list">
          <div class="loading"></div> <span class="bangla-font">লোড হচ্ছে...</span>
        </div>
      </div>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script>
    // কনস্ট্যান্টস
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzhx7GDy81h6mk5wSGqm0sWGmckUbT8I68HIrHmbA0XCI0dVh66SdAPF5Zpilhz2VcL/exec';
    
    // DOM elements
    const form = document.getElementById('feedback-form');
    const tabs = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const submissionsList = document.getElementById('submissions-list');
    const notification = document.getElementById('notification');
    
    // ট্যাব স্যুইচিং
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.getAttribute('data-tab');
        
        // সক্রিয় ট্যাব আপডেট করুন
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(tc => tc.classList.remove('active'));
        
        tab.classList.add('active');
        document.getElementById(`${tabId}-tab`).classList.add('active');
        
        // সাবমিশন ট্যাব হলে ডেটা লোড করুন
        if (tabId === 'submissions') {
          loadSubmissions();
        }
      });
    });
    
    // ফর্ম জমা দেওয়া
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submit-btn');
      const originalText = submitBtn.innerHTML;
      
      try {
        // লোডিং স্টেট সেট করুন
        submitBtn.innerHTML = '<div class="loading"></div> জমা হচ্ছে...';
        submitBtn.disabled = true;
        
        // ফর্ম ডেটা সংগ্রহ করুন
        const formData = {
          name: document.getElementById('name').value,
          batch: document.getElementById('batch').value,
          message: document.getElementById('message').value
        };
        
        // Google Apps Script-এ ডেটা সাবমিট করুন
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(formData),
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const result = await response.json();
        
        if (result.result === 'success') {
          showNotification('আপনার ফর্ম সফলভাবে জমা হয়েছে!', 'success');
          form.reset();
        } else {
          throw new Error(result.error || 'জমা দিতে সমস্যা হয়েছে');
        }
      } catch (error) {
        console.error('Error:', error);
        showNotification(`ত্রুটি: ${error.message}`, 'error');
      } finally {
        // বাটন রিসেট করুন
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });
    
    // সাবমিশন লোড করুন
    async function loadSubmissions() {
      try {
        submissionsList.innerHTML = '<div class="loading"></div> <span class="bangla-font">লোড হচ্ছে...</span>';
        
        const response = await fetch(`${SCRIPT_URL}?action=get`);
        const result = await response.json();
        
        if (result.result === 'success' && result.submissions.length > 0) {
          displaySubmissions(result.submissions);
        } else {
          submissionsList.innerHTML = `
            <div class="bangla-font" style="text-align: center; padding: 30px; color: var(--text-muted);">
              <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
              <p>কোনো সাবমিশন পাওয়া যায়নি</p>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading submissions:', error);
        submissionsList.innerHTML = `
          <div class="bangla-font" style="text-align: center; padding: 30px; color: var(--danger);">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px;"></i>
            <p>সাবমিশন লোড করতে সমস্যা: ${error.message}</p>
          </div>
        `;
      }
    }
    
    // সাবমিশন প্রদর্শন করুন
    function displaySubmissions(submissions) {
      // তারিখ অনুসারে সাজান (নতুন থেকে পুরানো)
      submissions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      submissionsList.innerHTML = submissions.map(sub => `
        <div class="submission-item">
          <div class="submission-header">
            <span class="submission-name bangla-font">${sub.name}</span>
            <span class="submission-batch bangla-font">${sub.batch}</span>
          </div>
          <div class="submission-time bangla-font">
            ${new Date(sub.timestamp).toLocaleString('bn-BD', { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit',
              timeZone: 'Asia/Dhaka'
            })}
          </div>
          <div class="submission-message bangla-font">${sub.message}</div>
          ${sub.comment ? `
            <div class="comment-section">
              <strong class="bangla-font">অ্যাডমিনের মন্তব্য:</strong>
              <div class="comment-display bangla-font">${sub.comment}</div>
            </div>
          ` : ''}
        </div>
      `).join('');
    }
    
    // নোটিফিকেশন প্রদর্শন করুন
    function showNotification(message, type = 'success') {
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
    
    // পৃষ্ঠা লোড হলে সাবমিশন ট্যাবে থাকলে ডেটা লোড করুন
    if (document.getElementById('submissions-tab').classList.contains('active')) {
      loadSubmissions();
    }
  </script>
</body>
</html>
